{% extends 'base.html' %}

{% block page_title %}{{ stats.nickname }} Player Stats | HonBot {% endblock %}

{% block main_content %}
<header class="player-head">
    <div class="container">
        <div class="row">
            <div class="col-lg-7 col-md-7 col-sm-12">
                <h1><div id="avatar" class="pull-left"></div> {{ stats.nickname }}</h1>
            </div>
            <div class="col-lg-5 col-md-5 col-sm-12">
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 col-lg-offset-2 col-md-offset-2 text-center">
                    <h4>mmr</h4>{{ stats.mmr }}
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-center">
                    <h4>tsr</h4>{{ stats.TSR }}
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-center">
                    <h4>win</h4>{{ stats.wins }}
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-center">
                    <h4>loss</h4>{{ stats.losses }}
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-center">
                    <h4 style="margin-top: 21px;">{{ stats.winpercent }}</h4>
                </div>
            </div>
        </div>
    </div>
</header>
<div class="container">
    <div class="row">
        <div class="col-lg-12 col-xs-12">
            <ul class="nav nav-pills nav-justified">
                <li><a href="/player/{{ stats.nickname }}/">Ranked</a></li>
                <li><a href="/c/player/{{ stats.nickname }}/">Casual</a></li>
                <li><a href="/p/player/{{ stats.nickname }}/">Public</a></li>
                <li class="active"><a href="/chart/{{ stats.nickname }}/">Charts</a></li>
                <li><a href="#banner" type="button" data-toggle="modal">Stats Banner</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="col-lg-3 well">
                <p>Hello! Stats were analyzed from your last <strong>{{count}}</strong> matches.</p>
                <p>Stats last updated: <strong>{{updated}}</strong></p>
                {%if count < 50%}<p>If fewer than 50 matches are being shown, try going back to the <a href="/player/{{ stats.nickname }}/">player stats page</a> and clicking "load more".</p>{%endif%}
                <p>This is currently being developed in my free time. Please be patient and as always <a href="https://forums.heroesofnewerth.com/showthread.php?489330-HonBot-com-Stats-Chat-Logs-Graphs">feedback is encouraged</a>.</p>
            </div>
            <div class="col-lg-9">
                <div id="mmr" style="min-width: 310px; height: 300px; margin: 0 auto"></div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h4 class="text-center">Recently Most Played Heroes</h4>
            <div class="row">
                {%for hero in heroes%}
                <div class="col-lg-2 col-sm-4 col-6">
                    <div class="panel">
                        <div style="margin-bottom: 18px;" class="panel-heading text-center panel-hero"><img style="width:50px" src='/static/img/heroes/{{hero.hero}}/icon_128.jpg'></div>
                        <ul style="margin-top: -16px;" class="list-group">
                            <li class="list-group-item panel-hero">Times Played: <p class="pull-right">{{hero.used}}</p></li>
                            <li class="list-group-item panel-hero">Avg.k/d/a: <p class="pull-right">{{hero.kills}}/{{hero.deaths}}/{{hero.assists}}</p></li>
                            <li class="list-group-item panel-hero">Wins: <p class="pull-right">{{hero.wins}} - {{hero.win_percent}}%</p></li>
                            <li class="list-group-item panel-hero">MMR +/-: {%if hero.mmr < 0%}<p class="pull-right text-danger">{%else%}<p class="pull-right text-success">{%endif%}{{hero.mmr}}</p></li>
                            <li class="list-group-item panel-hero">APM: <p class="pull-right">{{hero.apm}}</p></li>
                            <li class="list-group-item panel-hero">GPM: <p class="pull-right">{{hero.gpm}}</p></li>
                        </ul>
                    </div>
                </div>
                {%endfor%}
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-6">
                    <h4 class="text-center">APM</h4>
                    <div id="apm" style="min-width: 310px; height: 300px; margin: 0 auto"></div>
                </div>
                <div class="col-lg-6">
                    <h4 class="text-center">GPM</h4>
                    <div id="gpm" style="min-width: 310px; height: 300px; margin: 0 auto"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="banner">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Stats Banner: Updates every 24 hours!</h4>
            </div>
            <div class="modal-body text-center">
                <p id="bannerpos"></p>
                <p>
                    <h4>BB Code (forums)</h4>
                    <code>[url=http://honbot.com/player/{{stats.nickname}}/]<br>[img]http://honbot.com/banner/{{stats.nickname}}/[/img][/url]</code>
                    <h4>Direct Link</h4>
                    <code>http://honbot.com/banner/{{stats.nickname}}/</code>
                </p>
            </div>
        </div>
    </div>
</div>
<br>
{% endblock main_content %}
{%block js%}
<script src="/static/js/highcharts.js"></script>
<script>
$.get("/avatar/{{ stats.player_id }}/60/",
    function(data) {
        $('#avatar').append(data)
    });
</script>
<script>
$(function () {
    $('#mmr').highcharts({
        chart:{
            backgroundColor: null,
        },
        title: {
            text: '',
        },
        xAxis: {
            categories: [{%for m in match_list%}{{m}},{%endfor%}],
            labels:{enabled: false}
        },
        yAxis: [{
            title: {
                text: 'MMR'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        }],
        credits: {enabled: false},
        colors: ['#2C3E50'],
        tooltip: {
            shared: true,
            useHTML: true,
            formatter: function() {
                return '<strong>' + this.x + '</strong><br>' + Math.round(this.y*10)/10;
            },
        },
        plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                window.location.href = "/match/" + this.category + '/';
                            }
                        }
                    },
                }
            },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            showInLegend: false,
            name: 'MMR',
            data: [{%for m in mmr%}{{m}},{%endfor%}],
        }]
    });
});
</script>
<script>
$(function () {
    $('#apm').highcharts({
        chart:{
            backgroundColor: null,
        },
        title: {
            text: '',
        },
        xAxis: {
            categories: [{%for m in match_list%}{{m}},{%endfor%}],
            labels:{enabled: false}
        },
        yAxis: [{
            title: {
                text: ''
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        }],
        credits: {enabled: false},
        colors: ['#2C3E50'],
        tooltip: {
            shared: true,
            useHTML: true,
            formatter: function() {
                return '<strong>' + this.x + '</strong><br>' + Math.round(this.y*10)/10;
            },
        },
        plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                window.location.href = "/match/" + this.category + '/';
                            }
                        }
                    },
                }
            },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            showInLegend: false,
            name: 'APM',
            data: [{%for m in apm%}{{m}},{%endfor%}],
        }]
    });
});
</script>
<script>
$(function () {
    $('#gpm').highcharts({
        chart:{
            backgroundColor: null,
        },
        title: {
            text: '',
        },
        xAxis: {
            categories: [{%for m in match_list%}{{m}},{%endfor%}],
            labels:{enabled: false}
        },
        yAxis: [{
            title: {
                text: ''
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        }],
        credits: {enabled: false},
        colors: ['#2C3E50'],
        tooltip: {
            shared: true,
            useHTML: true,
            formatter: function() {
                return '<strong>' + this.x + '</strong><br>' + Math.round(this.y*10)/10;
            },
        },
        plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                window.location.href = "/match/" + this.category + '/';
                            }
                        }
                    },
                }
            },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            showInLegend: false,
            name: 'GPM',
            data: [{%for m in gpm%}{{m}},{%endfor%}],
        }]
    });
});
</script>
<script>
$('#banner').one('show.bs.modal', function () {
  $('#bannerpos').append('<img src="/banner/{{stats.nickname}}/">')
});
</script>
{%endblock js%}